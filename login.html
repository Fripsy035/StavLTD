<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>СЭД-СТАВ | Вход в систему</title>
    <link rel="stylesheet" href="style/styles.css">
</head>

<body class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <img src="img/logo.svg" alt="Логотип СЭД-СТАВ" class="auth-logo">
                <p>Система электронного документооборота</p>
            </div>

            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Введите ваш email"
                        required>
                </div>

                <div class="form-group password-group">
                    <label class="form-label" for="password">Пароль</label>
                    <div class="password-field">
                        <input type="password" class="form-control" id="password" name="password"
                            placeholder="Введите пароль" required>
                        <button type="button" class="password-toggle" aria-label="Показать пароль">
                            <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path d="M12 5C6.5 5 2 9.5 2 12s4.5 7 10 7 10-4.5 10-7-4.5-7-10-7zm0 12c-3.6 0-6.5-3.2-7.4-5 .9-1.8 3.8-5 7.4-5 3.6 0 6.5 3.2 7.4 5-.9 1.8-3.8 5-7.4 5zm0-8a3 3 0 100 6 3 3 0 000-6z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="form-group form-remember">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="remember" name="remember">
                        <label class="form-check-label" for="remember">Запомнить меня</label>
                    </div>
                    <a href="#" class="forgot-password">Забыли пароль?</a>
                </div>

                <button type="submit" class="btn btn-primary btn-auth">Войти</button>
            </form>

            <p class="auth-demo-hint">
                Тестовый администратор:<br>
                <span>ivanov@stav-ltd.ru / admin123</span>
            </p>
        </div>
    </div>

    <div class="modal" id="forgotPasswordModal" aria-hidden="true">
        <div class="modal-overlay" data-close-forgot></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Восстановление пароля</h3>
                <button type="button" class="modal-close" id="closeForgotPasswordModal" aria-label="Закрыть">&times;</button>
            </div>
            <div class="modal-body">
                <p>Для выдачи нового пароля обратитесь к администратору системы.</p>
                <p>Вы можете написать на <strong>support@stav-ltd.ru</strong> или связаться с вашим системным администратором по внутренним каналам.</p>
                <p>После подтверждения личности администратор выдаст новый временный пароль.</p>
            </div>
        </div>
    </div>

    <script src="script/database.js"></script>
    <script src="script/script.js"></script>
    <script src="script/auth.js"></script>
    <script>
        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const remember = document.getElementById('remember').checked;

            const result = await auth.login(email, password, remember);
            
            if (result.success) {
                window.location.href = 'index.html';
            } else {
                alert(result.message || 'Неверный email или пароль');
            }
        });

        const forgotPasswordLink = document.querySelector('.forgot-password');
        const forgotPasswordModal = document.getElementById('forgotPasswordModal');
        const closeForgotPasswordModal = document.getElementById('closeForgotPasswordModal');
        const forgotOverlay = document.querySelector('[data-close-forgot]');

        function openForgotModal() {
            if (!forgotPasswordModal) return;
            forgotPasswordModal.classList.add('active');
            forgotPasswordModal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
        }

        function closeForgotModal() {
            if (!forgotPasswordModal) return;
            forgotPasswordModal.classList.remove('active');
            forgotPasswordModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        if (forgotPasswordLink) {
            forgotPasswordLink.addEventListener('click', function (e) {
                e.preventDefault();
                openForgotModal();
            });
        }

        if (closeForgotPasswordModal) {
            closeForgotPasswordModal.addEventListener('click', closeForgotModal);
        }

        if (forgotOverlay) {
            forgotOverlay.addEventListener('click', closeForgotModal);
        }

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && forgotPasswordModal && forgotPasswordModal.classList.contains('active')) {
                closeForgotModal();
            }
        });

        const passwordToggle = document.querySelector('.password-toggle');
        if (passwordToggle) {
            passwordToggle.addEventListener('click', function () {
                const passwordInput = document.getElementById('password');
                const isVisible = passwordInput.type === 'text';
                passwordInput.type = isVisible ? 'password' : 'text';
                this.classList.toggle('active', !isVisible);
                this.setAttribute('aria-label', isVisible ? 'Показать пароль' : 'Скрыть пароль');
            });
        }
    </script>
</body>

</html>