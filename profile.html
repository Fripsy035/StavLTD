<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–≠–î-–°–¢–ê–í | –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <link rel="stylesheet" href="style/styles.css">
</head>

<body>
    <header>
        <div class="container">
            <div class="header-top">
                <div class="logo">
                    <img src="img/logo.svg" alt="–õ–æ–≥–æ—Ç–∏–ø –°–≠–î-–°–¢–ê–í" class="logo-icon">
                </div>

                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">–ò–ò</div>
                    <div>
                        <div class="user-name" id="userName">–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω</div>
                        <div class="user-role" id="userRole">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                    </div>
                    <button class="logout-btn">–í—ã–π—Ç–∏</button>
                </div>
                <button class="mobile-menu-toggle">‚ò∞</button>
            </div>
        </div>
        <nav id="main-nav">
            <div class="nav-container">
                <ul class="nav-menu">
                    <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="documents.html">–î–æ–∫—É–º–µ–Ω—Ç—ã</a></li>
                    <li><a href="approvals.html">–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è</a></li>
                    <li><a href="reports.html">–û—Ç—á–µ—Ç—ã</a></li>
                    <li><a href="settings.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                    <li><a href="profile.html" class="active">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="main-content">
            <div class="content">
                <div class="section-header">
                    <h2 class="section-title">–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                </div>

                <div class="profile-container">
                    <div class="profile-header">
                        <div class="profile-avatar-large" id="profileAvatar">–ò–ò</div>
                        <div class="profile-info">
                            <h3 id="profileName">–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω</h3>
                            <p id="profileEmail">i.ivanov@stav-ltd.ru</p>
                            <p id="profileRole">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</p>
                        </div>
                    </div>

                    <div class="profile-tabs">
                        <div class="tab active" data-tab="personal">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
                        <div class="tab" data-tab="security">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</div>
                        <div class="tab" data-tab="activity">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                    </div>

                    <div class="tab-content active" id="personal">
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <h3 class="settings-card-title">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                            </div>
                            <form class="settings-form" id="personalForm">
                                <div class="form-group">
                                    <label class="form-label" for="fullName">–§–ò–û</label>
                                    <input type="text" class="form-control" id="fullName" name="fullName" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="email">Email</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="+7 (___) ___-__-__">
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="department">–û—Ç–¥–µ–ª</label>
                                    <input type="text" class="form-control" id="department" name="department">
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="position">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                                    <input type="text" class="form-control" id="position" name="position">
                                </div>

                                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                            </form>
                        </div>
                    </div>

                    <div class="tab-content" id="security">
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <h3 class="settings-card-title">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>
                            </div>
                            <form class="settings-form" id="passwordForm">
                                <div class="form-group">
                                    <label class="form-label" for="currentPassword">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                                    <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="newPassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                    <input type="password" class="form-control" id="newPassword" name="newPassword" required minlength="6">
                                    <div class="form-text">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="confirmNewPassword">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è</label>
                                    <input type="password" class="form-control" id="confirmNewPassword" name="confirmNewPassword" required>
                                </div>

                                <button type="submit" class="btn btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                            </form>
                        </div>
                    </div>

                    <div class="tab-content" id="activity">
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <h3 class="settings-card-title">–ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                            </div>
                            <div class="activity-list">
                                <div class="activity-item">
                                    <div class="activity-icon">üìÑ</div>
                                    <div class="activity-content">
                                        <div class="activity-title">–°–æ–∑–¥–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç –ì–∞–º–º–∞"</div>
                                        <div class="activity-date">12.10.2023 14:30</div>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon">‚úì</div>
                                    <div class="activity-content">
                                        <div class="activity-title">–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç "–û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–µ–∫—Ç—É –ê–ª—å—Ñ–∞"</div>
                                        <div class="activity-date">10.10.2023 11:15</div>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon">üë§</div>
                                    <div class="activity-content">
                                        <div class="activity-title">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</div>
                                        <div class="activity-date">08.10.2023 09:00</div>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon">‚úèÔ∏è</div>
                                    <div class="activity-content">
                                        <div class="activity-title">–ò–∑–º–µ–Ω–µ–Ω –ø—Ä–æ—Ñ–∏–ª—å</div>
                                        <div class="activity-date">05.10.2023 16:45</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>–°–∏—Å—Ç–µ–º–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞ "–°–≠–î-–°–¢–ê–í" ¬© 2023</p>
            <p>–ö–æ–º–ø–∞–Ω–∏—è "–°–¢–ê–í –õ–¢–î"</p>
        </div>
    </footer>

    <script src="script/database.js"></script>
    <script src="script/script.js"></script>
    <script src="script/auth.js"></script>
    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.addEventListener('DOMContentLoaded', function() {
            const user = auth.getCurrentUser();
            if (user) {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
                document.getElementById('profileName').textContent = user.fullName || user.name;
                document.getElementById('profileEmail').textContent = user.email;
                document.getElementById('profileRole').textContent = user.role || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
                const initials = auth.getInitials(user.fullName || user.name);
                document.getElementById('profileAvatar').textContent = initials;
                
                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
                document.getElementById('fullName').value = user.fullName || user.name || '';
                document.getElementById('email').value = user.email || '';
                document.getElementById('phone').value = user.phone || '';
                document.getElementById('department').value = user.department || '';
                document.getElementById('position').value = user.position || '';
            } else {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                window.location.href = 'login.html';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('personalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const user = auth.getCurrentUser();
            if (user) {
                const updatedUser = {
                    ...user,
                    fullName: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    department: document.getElementById('department').value,
                    position: document.getElementById('position').value
                };
                auth.updateUser(updatedUser);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                document.getElementById('profileName').textContent = updatedUser.fullName;
                document.getElementById('profileEmail').textContent = updatedUser.email;
                const initials = auth.getInitials(updatedUser.fullName);
                document.getElementById('profileAvatar').textContent = initials;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ header
                document.getElementById('userName').textContent = updatedUser.fullName;
                const headerInitials = auth.getInitials(updatedUser.fullName);
                document.getElementById('userAvatar').textContent = headerInitials;
                
                alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;

            if (newPassword !== confirmPassword) {
                alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                return;
            }

            const user = auth.getCurrentUser();
            auth.changePassword(currentPassword, newPassword).then(result => {
                if (result) {
                    alert('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!');
                    document.getElementById('passwordForm').reset();
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å!');
                }
            });
        });
    </script>
</body>

</html>

